pragma solidity ^0.4.24;

import "truffle/Assert.sol";
import "../contracts/lib/bn256.sol";

contract TestBN256 {
    
    function testPointAddAndScalarMul()  returns(bool) {
        BN256.G1Point memory p1 = BN256.P1();
        BN256.G1Point memory p2 = BN256.P1();           
        BN256.G1Point memory sum = BN256.pointAdd(p1, p2);
        BN256.G1Point memory p3 = BN256.scalarMul(p1,2);  
        return (sum.x == p3.x && sum.y == p3.y);
    }

    function testPairingCheck()  returns(bool) {
        BN256.G1Point memory p1 = BN256.G1Point(7985250684665362734034207174567341000146996823387166378141631317099216977152, 5471024627060516972461571110176333017668072838695251726406965080926450112048);
        BN256.G2Point memory p2 = BN256.G2Point(
            [15516709285352539082439213720585739724329002971882390582209636960597958801449, 19324541677661060388134143597417835654030498723817274130329567224531700170734],
            [16550775633156536193089672538964908973667410921848053632462693002610771214528, 10154483139478025296468271477739414260393126999813603835827647034319242387010]
        );
        BN256.G2Point memory p3 = BN256.G2Point(
            [14125383697019450293340447180826714775062600193406387386692146468060627933203, 10886345395648455940547500614900453787797209052692168129177801883734751834552],
            [13494666809312056575532152175382485778895768300692817869062640713829304801648, 10580958449683540742032499469496205826101096579572266360455646078388895706251]
        );
        bytes memory data0 = hex"7b0a2020226f70656e223a207b0a20202020227072696365223a2039353931372c0a202020202274696d65223a207b0a20202020202022756e6978223a20313438333134323430302c0a2020202020202269736f223a2022323031362d31322d33315430303a30303a30302e3030305a220a202020207d0a20207d2c0a202022636c6f7365223a207b0a20202020227072696365223a2039363736302c0a202020202274696d65223a207b0a20202020202022756e6978223a20313438333232383830302c0a2020202020202269736f223a2022323031372d30312d30315430303a30303a30302e3030305a220a202020207d0a20207d2c0a2020226c6f6f6b7570223a207b0a20202020227072696365223a2039363736302c0a20202020226b223a20312c0a202020202274696d65223a207b0a20202020202022756e6978223a20313438333232383830302c0a2020202020202269736f223a2022323031372d30312d30315430303a30303a30302e3030305a220a202020207d0a20207d0a7d0a6578616d706c652e636f6d2f6170692f30";
        bytes memory data1 = hex"7b0a2020226f70656e223a207b0a20202020227072696365223a2039353931372c0a202020202274696d65223a207b0a20202020202022756e6978223a20313438333134323430302c0a2020202020202269736f223a2022323031362d31322d33315430303a30303a30302e3030305a220a202020207d0a20207d2c0a202022636c6f7365223a207b0a20202020227072696365223a2039363736302c0a202020202274696d65223a207b0a20202020202022756e6978223a20313438333232383830302c0a2020202020202269736f223a2022323031372d30312d30315430303a30303a30302e3030305a220a202020207d0a20207d2c0a2020226c6f6f6b7570223a207b0a20202020227072696365223a2039363736302c0a20202020226b223a20312c0a202020202274696d65223a207b0a20202020202022756e6978223a20313438333232383830302c0a2020202020202269736f223a2022323031372d30312d30315430303a30303a30302e3030305a220a202020207d0a20207d0a7d0a6578616d706c652e636f6d2f6170692f31";
        BN256.G1Point memory hashp1 = BN256.hashToG1(data0);
        BN256.G1Point memory hashp2 = BN256.hashToG1(data1);

        BN256.G1Point[] memory g1points = new BN256.G1Point[](3);
        BN256.G2Point[] memory g2points = new BN256.G2Point[](3);

        g1points[0] = BN256.negate(p1);
        g1points[1] = hashp1;
        g1points[2] = hashp2;
        g2points[0] = BN256.P2();
        g2points[1] = p2;
        g2points[2] = p3;
  
        if (!BN256.pairingCheck(g1points,g2points)) {
            return false;
        }
        return true;
    }
}